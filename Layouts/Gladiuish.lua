local layoutName = "Gladiuish"
local layout = {}
layout.name = "Gladiuish |A:NewCharacter-Alliance:38:65|a"

layout.defaultSettings = {
    posX = 355,
    posY = 131,
    scale = 1.15,
    classIconFontSize = 14,
    spacing = 35,
    growthDirection = 1,
    specIcon = {
        posX = -21,
        posY = -2,
        scale = 1,
    },
    trinket = {
        posX = 104,
        posY = 0,
        scale = 1,
        fontSize = 14,
    },
    racial = {
        posX = 180,
        posY = 0,
        scale = 0.8,
        fontSize = 14,
    },
    castBar = {
        posX = 8,
        posY = -23.5,
        scale = 1.35,
        width = 108,
        iconScale = 1,
        iconPosX = 5,
        keepDefaultModernTextures = true,
    },
    dr = {
        posX = -101,
        posY = 0,
        size = 28,
        borderSize = 2.5,
        fontSize = 12,
        spacing = 6,
        growthDirection = 4,
    },
    statusText = {
        usePercentage = true,
        alwaysShow = true,
    },

    textures          = {
        generalStatusBarTexture       = "sArena Default",
        healStatusBarTexture          = "sArena Stripes",
        castbarStatusBarTexture       = "sArena Default",
    },
    retextureHealerClassStackOnly = true,

    -- custom layout settings
    frameFont = "Prototype",
    cdFont  = "Prototype",
    changeFont = true,
    width = 168,
    height = 44,
    powerBarHeight = 9,
    mirrored = true,
    classicBars = false,
    replaceClassIcon = true,
    showSpecManaText = true,
    
    -- text settings defaults
    textSettings = {
        nameAnchor = "LEFT",
        nameSize = 1.0,
        nameOffsetX = 0,
        nameOffsetY = 0,
        healthAnchor = "RIGHT", 
        healthSize = 1.0,
        healthOffsetX = 0,
        healthOffsetY = 0,
        specNameAnchor = "LEFT",
        specNameSize = 1.0,
        specNameOffsetX = 0,
        specNameOffsetY = 0,
        castbarAnchor = "CENTER",
        castbarSize = 1.0,
        castbarOffsetX = 0,
        castbarOffsetY = 0,
    },
}

local function getSetting(info)
    return layout.db[info[#info]]
end

local function setSetting(info, val)
    layout.db[info[#info]] = val

    for i = 1, sArenaMixin.maxArenaOpponents do
        local frame = info.handler["arena" .. i]
        frame:SetSize(layout.db.width, layout.db.height)
        frame.ClassIcon:SetSize(layout.db.height, layout.db.height)
        frame.DeathIcon:SetSize(layout.db.height * 0.8, layout.db.height * 0.8)
        frame.PowerBar:SetHeight(layout.db.powerBarHeight)
        layout:UpdateOrientation(frame)
    end
    sArenaMixin:RefreshConfig()
end

local function setupOptionsTable(self)
    layout.optionsTable = self:GetLayoutOptionsTable(layoutName)

    layout.optionsTable.arenaFrames.args.positioning.args.mirrored = {
        order = 5,
        name = "Mirrored Frames",
        type = "toggle",
        width = "full",
        get = getSetting,
        set = setSetting,
    }

    layout.optionsTable.arenaFrames.args.sizing.args.width = {
        order = 3,
        name = "Width",
        type = "range",
        min = 40,
        max = 400,
        step = 1,
        get = getSetting,
        set = setSetting,
    }

    layout.optionsTable.arenaFrames.args.sizing.args.height = {
        order = 4,
        name = "Height",
        type = "range",
        min = 2,
        max = 100,
        step = 1,
        get = getSetting,
        set = setSetting,
    }

    layout.optionsTable.arenaFrames.args.sizing.args.powerBarHeight = {
        order = 5,
        name = "Power Bar Height",
        type = "range",
        min = 1,
        max = 50,
        step = 1,
        get = getSetting,
        set = setSetting,
    }

    layout.optionsTable.arenaFrames.args.other.args.showSpecManaText = {
        order = 3,
        name = "Spec Text on Manabar",
        type = "toggle",
        get = getSetting,
        set = setSetting,
    }

    layout.optionsTable.arenaFrames.args.other.args.cropIcons = {
        order = 5,
        name = "Crop Icons",
        type = "toggle",
        get = getSetting,
        set = setSetting,
    }
end

function layout:Initialize(frame)
    self.db = frame.parent.db.profile.layoutSettings[layoutName]
    sArenaMixin.useSpecClassIcon = true

    if (not self.optionsTable) then
        setupOptionsTable(frame.parent)
    end

    if (frame:GetID() == sArenaMixin.maxArenaOpponents) then
        frame.parent:UpdateCastBarSettings(self.db.castBar)
        frame.parent:UpdateDRSettings(self.db.dr)
        frame.parent:UpdateFrameSettings(self.db)
        frame.parent:UpdateSpecIconSettings(self.db.specIcon)
        frame.parent:UpdateTrinketSettings(self.db.trinket)
        frame.parent:UpdateRacialSettings(self.db.racial)
    end

    frame:SetSize(self.db.width, self.db.height)
    frame.SpecIcon:SetSize(22, 22)
    frame.Trinket:SetSize(41, 41)
    frame.Racial:SetSize(41, 41)
    frame.Name:SetTextColor(1,1,1)
    frame.SpecNameText:SetTextColor(1,1,1)

    frame.Trinket.Cooldown:SetSwipeTexture(1)
    frame.Trinket.Cooldown:SetSwipeColor(0, 0, 0, 0.6)


    frame.PowerBar:SetHeight(self.db.powerBarHeight)

    frame.ClassIcon:SetSize(self.db.height-4, self.db.height-4)
    frame.ClassIcon:Show()

    local f = frame.Name
    f:SetJustifyH("LEFT")
    f:SetFontObject("Game10Font_o1")
    f:SetPoint("LEFT", frame.HealthBar, "LEFT", 3, -1)
    f:SetHeight(12)

    f = frame.DeathIcon
    f:ClearAllPoints()
    f:SetPoint("CENTER", frame.HealthBar, "CENTER", 0, -1)
    f:SetSize(self.db.height * 0.8, self.db.height * 0.8)

    --frame.HealthText:SetShadowOffset(0, 0)

    frame.PowerText:SetPoint("CENTER", frame.PowerBar)
    --frame.PowerText:SetShadowOffset(0, 0)
    frame.PowerText:SetAlpha(0)

    -- Health bar underlay
    if not frame.hpUnderlay then
        frame.hpUnderlay = frame:CreateTexture(nil, "BACKGROUND", nil, 1)
        frame.hpUnderlay:SetPoint("TOPLEFT", frame.HealthBar, "TOPLEFT")
        frame.hpUnderlay:SetPoint("BOTTOMRIGHT", frame.HealthBar, "BOTTOMRIGHT")
        frame.hpUnderlay:SetColorTexture(0, 0, 0, 0.65)
        frame.hpUnderlay:Show()
    end

    -- Power bar underlay
    if not frame.ppUnderlay then
        frame.ppUnderlay = frame:CreateTexture(nil, "BACKGROUND", nil, 1)
        frame.ppUnderlay:SetPoint("TOPLEFT", frame.PowerBar, "TOPLEFT")
        frame.ppUnderlay:SetPoint("BOTTOMRIGHT", frame.PowerBar, "BOTTOMRIGHT")
        frame.ppUnderlay:SetColorTexture(0, 0, 0, 0.65)
        frame.ppUnderlay:Show()
    end

    self:UpdateOrientation(frame)
end

function layout:UpdateOrientation(frame)
    local healthBar = frame.HealthBar
    local powerBar = frame.PowerBar
    local classIcon = frame.ClassIcon
    local name = frame.Name
    local specName = frame.SpecNameText
    local healthText = frame.HealthText
    local castbarText = frame.CastBar.Text

    healthBar:ClearAllPoints()
    powerBar:ClearAllPoints()
    classIcon:ClearAllPoints()
    frame.ClassIcon:SetSize(self.db.height-4, self.db.height-4)

    if self.db.textSettings then
        local txt = self.db.textSettings
        local modernCastbar = self.db.castBar.useModernCastbars

        name:SetScale(txt.nameSize)
        healthText:SetScale(txt.healthSize)
        specName:SetScale(txt.specNameSize)
        castbarText:SetScale(txt.castbarSize)

        -- Name
        name:ClearAllPoints()
        if txt.nameAnchor == "LEFT" then
            name:SetPoint("LEFT", frame.HealthBar, "LEFT", 3 + txt.nameOffsetX, -1 + txt.nameOffsetY)
        elseif txt.nameAnchor == "RIGHT" then
            name:SetPoint("RIGHT", frame.HealthBar, "RIGHT", -3 + txt.nameOffsetX, -1 + txt.nameOffsetY)
        else
            name:SetPoint("CENTER", frame.HealthBar, "CENTER", txt.nameOffsetX, -1 + txt.nameOffsetY)
        end

        -- Health Text
        healthText:ClearAllPoints()
        if txt.healthAnchor == "LEFT" then
            healthText:SetPoint("LEFT", healthBar, "LEFT", 0 + txt.healthOffsetX, 1 + txt.healthOffsetY)
        elseif txt.healthAnchor == "RIGHT" then
            healthText:SetPoint("RIGHT", healthBar, "RIGHT", 0 + txt.healthOffsetX, -1 + txt.healthOffsetY)
        else
            healthText:SetPoint("CENTER", healthBar, "CENTER", txt.healthOffsetX, -1 + txt.healthOffsetY)
        end

        -- Spec Text
        specName:ClearAllPoints()
        if txt.specNameAnchor == "LEFT" then
            specName:SetPoint("LEFT", frame.PowerBar, "LEFT", 3 + txt.specNameOffsetX, txt.specNameOffsetY)
        elseif txt.specNameAnchor == "RIGHT" then
            specName:SetPoint("RIGHT", frame.PowerBar, "RIGHT", -3 + txt.specNameOffsetX, txt.specNameOffsetY)
        else
            specName:SetPoint("CENTER", frame.PowerBar, "CENTER", txt.specNameOffsetX, txt.specNameOffsetY)
        end

        -- Castbar Text
        castbarText:ClearAllPoints()
        if txt.castbarAnchor == "LEFT" then
            castbarText:SetPoint("LEFT", frame.CastBar, "LEFT", 3 + txt.castbarOffsetX, (modernCastbar and -11 or 0) + txt.castbarOffsetY)
        elseif txt.castbarAnchor == "RIGHT" then
            castbarText:SetPoint("RIGHT", frame.CastBar, "RIGHT", -3 + txt.castbarOffsetX, (modernCastbar and -11 or 0) + txt.castbarOffsetY)
        else
            castbarText:SetPoint("CENTER", frame.CastBar, "CENTER", txt.castbarOffsetX, (modernCastbar and -11 or 0) + txt.castbarOffsetY)
        end
    end

    if (self.db.mirrored) then
        healthBar:SetPoint("TOPRIGHT", frame, "TOPRIGHT", 0, -2)
        healthBar:SetPoint("BOTTOMLEFT", powerBar, "TOPLEFT")

        powerBar:SetPoint("BOTTOMRIGHT", frame, "BOTTOMRIGHT", 0, 2)
        powerBar:SetPoint("LEFT", classIcon, "RIGHT", 0, 0)

        classIcon:SetPoint("TOPLEFT", frame, "TOPLEFT", 0, -2)
    else
        healthBar:SetPoint("TOPLEFT", frame, "TOPLEFT", 0, -2)
        healthBar:SetPoint("BOTTOMRIGHT", powerBar, "TOPRIGHT")

        powerBar:SetPoint("BOTTOMLEFT", frame, "BOTTOMLEFT", 0, 2)
        powerBar:SetPoint("RIGHT", classIcon, "LEFT", 0, 0)

        classIcon:SetPoint("TOPRIGHT", frame, "TOPRIGHT", 0, -2)
    end
end

sArenaMixin.layouts[layoutName] = layout
sArenaMixin.defaultSettings.profile.layoutSettings[layoutName] = layout.defaultSettings